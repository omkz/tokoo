<div class="max-w-4xl mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-8">Checkout</h1>

  <%= form_with model: @order, url: checkouts_path, html: { id: "checkout-form" }, data: { turbo: false } do |f| %>
    <% if @order.errors.any? %>
      <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
        <h2 class="text-red-700 font-bold mb-2">
          <%= pluralize(@order.errors.count, "error") %> prohibited this order from being saved:
        </h2>
        <ul class="list-disc list-inside text-red-600">
          <% @order.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Customer Information -->
      <div class="space-y-6">
        <div class="bg-white p-6 rounded-lg shadow">
          <h2 class="text-xl font-semibold mb-4">Contact Information</h2>
          <div class="space-y-4">
            <div>
              <%= f.label :customer_email, "Email", class: "block text-sm font-medium text-gray-700" %>
              <%= f.email_field :customer_email, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
            </div>
            <div>
              <%= f.label :customer_name, "Full Name", class: "block text-sm font-medium text-gray-700" %>
              <%= f.text_field :customer_name, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
            </div>
            <div>
              <%= f.label :customer_phone, "Phone Number", class: "block text-sm font-medium text-gray-700" %>
              <%= f.telephone_field :customer_phone, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
            </div>
          </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
          <h2 class="text-xl font-semibold mb-4">Shipping Address</h2>
          <%= f.fields_for :order_addresses, @shipping_address do |sa| %>
            <%= sa.hidden_field :address_type, value: 'shipping' %>
            <div class="space-y-4">
              <div>
                <%= sa.label :full_name, "Recipient Name", class: "block text-sm font-medium text-gray-700" %>
                <%= sa.text_field :full_name, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
              </div>
              <div>
                <%= sa.label :address_line1, "Address Line 1", class: "block text-sm font-medium text-gray-700" %>
                <%= sa.text_field :address_line1, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
              </div>
              <div>
                <%= sa.label :address_line2, "Address Line 2 (Optional)", class: "block text-sm font-medium text-gray-700" %>
                <%= sa.text_field :address_line2, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <%= sa.label :city, "City", class: "block text-sm font-medium text-gray-700" %>
                  <%= sa.text_field :city, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
                </div>
                <div>
                  <%= sa.label :state_province, "State/Province", class: "block text-sm font-medium text-gray-700" %>
                  <%= sa.text_field :state_province, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <%= sa.label :postal_code, "Postal Code", class: "block text-sm font-medium text-gray-700" %>
                  <%= sa.text_field :postal_code, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
                </div>
                <div>
                  <%= sa.label :country, "Country", class: "block text-sm font-medium text-gray-700" %>
                  <%= sa.text_field :country, value: "Indonesia", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500", required: true %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- Order Summary & Shipping Method -->
      <div class="space-y-6">
        <div class="bg-white p-6 rounded-lg shadow border border-slate-100">
          <h2 class="text-xl font-semibold mb-4 text-slate-900 flex items-center gap-2">
            <svg class="h-5 w-5 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 17v-2m3 2v-2m3 2v-2" />
            </svg>
            Metode Pengiriman
          </h2>
          <div class="space-y-4">
            <% if @shipping_methods.any? %>
              <% @shipping_methods.each do |method| %>
                <div class="flex items-center p-4 border rounded-xl hover:bg-slate-50 transition-colors">
                  <%= f.radio_button :shipping_method_id, method.id, class: "h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300", checked: true %>
                  <label for="order_shipping_method_id_<%= method.id %>" class="ml-3 block text-sm font-medium text-slate-700">
                    <%= method.name %> - <%= number_to_currency(method.price) %>
                  </label>
                </div>
              <% end %>
            <% else %>
              <p class="text-sm text-slate-500">Metode pengiriman tidak tersedia.</p>
            <% end %>
          </div>
        </div>

        <%= render partial: "order_summary", locals: { cart: @cart, discount_amount: @discount_amount || 0, coupon_success: !!session[:applied_coupon_id] } %>
      </div>
    </div>
  <% end %>
</div>
